<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>1.4 Async - COMP4768: Software Development for Mobile Devices</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "1.4 Async";
        var mkdocs_page_input_path = "1.4_async.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> COMP4768: Software Development for Mobile Devices
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Module 0: Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../0.0_course_intro/">0.0 Course Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../0.1_getting_started/">0.1 Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../0.2_hello_world/">0.2 Hello World</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Module 1: Dart</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../1.0_syntax_basics/">1.0 Syntax Basics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1.1_types/">1.1 Types</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1.2_functions_controlFlow_errorHandling/">1.2 Functions, Control Flow & Error Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1.3_oop/">1.3 OOP</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">1.4 Async</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#futures">Futures</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#what-is-a-future">What is a Future?</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#states-of-a-future">States of a Future</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#basic-example">Basic Example</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#error-example">Error Example</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quick-summary">Quick Summary</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-async-and-await">Using async and await</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#3-tasks-example">3 Tasks example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-happens-if-task-3-has-to-wait-for-task-2-to-finish">What happens if Task 3 has to wait for Task 2 to finish</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#lets-use-await-to-wait-for-the-future-to-complete">Lets use await to wait for the future to complete</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1.5_null_safety/">1.5 Null Safety</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1.9_pratice_questions/">1.9 Practice Questions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../9.1_how_to_git/">A: How to Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../9.2_analysis_options.yaml/">B: Modify analysis_options.yaml to make it chill</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">COMP4768: Software Development for Mobile Devices</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Module 1: Dart &raquo;</li>
      <li class="breadcrumb-item active">1.4 Async</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="asynchronous-programming-futures-async-and-await">Asynchronous programming: futures, async, and await</h1>
<p><a href="../assets/ConcurrencyInDart.pptx"><strong>In Class Slides</strong></a></p>
<h2 id="introduction">Introduction</h2>
<p>In this weather application, tapping the "Get Temperature" button initiates an asynchronous request to the OpenWeatherAPI servers. The app uses the API key to fetch current weather data for the city name entered by the user. Once the data is received, it updates the user interface without affecting the app's responsiveness.</p>
<p>If all operations were carried out synchronously, the app could become unresponsive while waiting for the data to be fetched, leading to a subpar user experience.</p>
<p><img alt="Alt text" src="../assets/1.4.0.png" width="300" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">ElevatedButton</span><span class="p">(</span>
<span class="w">  </span><span class="nl">onPressed:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Weather</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">WeatherFactory</span><span class="p">(</span><span class="n">OPENWEATHER_API_KEY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">currentWeatherByCityName</span><span class="p">(</span><span class="n">cityNameController</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">temperature</span><span class="o">!</span><span class="p">.</span><span class="n">celsius</span><span class="o">?</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
<span class="w">    </span><span class="n">setState</span><span class="p">(()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">weatherInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nl">child:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Get Temperature&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>

<p>By using asynchronous programming constructs like <code>async</code> and <code>await</code>, the application performs the IO-bound work in the background. This means that the UI remains responsive, allowing users to interact with other parts of the application while the data is being fetched. </p>
<p>Dart libraries have many functions that give back Future or Stream objects. These functions are quick to respond because they start a task that might take time (like reading a file) but don't wait for it to finish. They let your program keep running other things while waiting for the task to complete.</p>
<p>The <code>async</code> and <code>await</code> keywords help you write code that can do multiple things at once, but the code still looks and reads like regular, one-thing-at-a-time (or sequential) code.</p>
<h2 id="futures">Futures</h2>
<h3 id="what-is-a-future">What is a Future?</h3>
<p>A Future is a Dart class that represents the outcome of an asynchronous operation. It can be in one of two states: either waiting for a result (Uncompleted) or having a result (Completed).</p>
<h4 id="states-of-a-future">States of a Future</h4>
<ul>
<li>
<p><strong>Uncompleted</strong>: When you call an async function, it gives you a Future that is waiting for the operation to finish or fail.</p>
</li>
<li>
<p><strong>Completed</strong>: The Future is done and holds either a value or an error.</p>
</li>
</ul>
<h5 id="types-of-completion">Types of Completion</h5>
<ul>
<li>
<p><strong>With Value</strong>: A Future of type <code>Future&lt;T&gt;</code> holds a value of type <code>T</code>. For example, <code>Future&lt;String&gt;</code> will have a string value.</p>
</li>
<li>
<p><strong>With Error</strong>: If the async operation fails, the Future holds an error.</p>
</li>
</ul>
<h3 id="examples">Examples</h3>
<h4 id="basic-example">Basic Example</h4>
<p>Here's a simple example where <code>fetchUserOrder()</code> returns a Future that completes after a delay. It doesn't return a value, so its type is <code>Future&lt;void&gt;</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fetchUserOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Future</span><span class="p">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Large Latte&#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">fetchUserOrder</span><span class="p">();</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Fetching user order...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>In this example, "Fetching user order..." will print before "Large Latte" because of the delay in <code>fetchUserOrder()</code>.</p>
<h4 id="error-example">Error Example</h4>
<p>In the following example, <code>fetchUserOrder()</code> completes with an error.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fetchUserOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Future</span><span class="p">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span><span class="w"> </span><span class="m">2</span><span class="p">),</span>
<span class="w">      </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">Exception</span><span class="p">(</span><span class="s1">&#39;Logout failed: user ID is invalid&#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">fetchUserOrder</span><span class="p">();</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Fetching user order...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Here, the Future completes with an error about an invalid user ID.</p>
<h3 id="quick-summary">Quick Summary</h3>
<ul>
<li>A <code>Future&lt;T&gt;</code> holds a value of type <code>T</code>.</li>
<li>If it doesn't hold a value, its type is <code>Future&lt;void&gt;</code>.</li>
<li>A Future can be either waiting for a result or completed with a value or an error.</li>
</ul>
<p>That's the basics of Futures in Dart. You'll learn how to use them effectively with <code>async</code> and <code>await</code> in the next section.</p>
<h2 id="using-async-and-await">Using <code>async</code> and <code>await</code></h2>
<h3 id="3-tasks-example">3 Tasks example</h3>
<p>In this example, there are three tasks. Task 2 utilizes the <code>Future.delayed</code> function, which causes Task 2 to wait asynchronously. The words "Task 2 complete" is only printed once the waiting period is over.</p>
<iframe style="width:600px;height:800px;" src="https://dartpad.dev/embed-inline.html?id=83cda512c1c5269b6ee4a4513c8354aa"></iframe>

<h3 id="what-happens-if-task-3-has-to-wait-for-task-2-to-finish">What happens if Task 3 has to wait for Task 2 to finish</h3>
<p>In the following example, since task3 does not wait for task2 to finish executing, the output does not include the task2Data.</p>
<iframe style="width:600px;height:800px;" src="https://dartpad.dev/embed-inline.html?id=8f373bfeb293a6f993d5f55ffaf205de"></iframe>

<p>To solve this problem, we need to ask task3 to wait for task2 to finish executing.</p>
<h3 id="lets-use-await-to-wait-for-the-future-to-complete">Lets use <code>await</code> to wait for the future to complete</h3>
<p>Now we will add <code>await</code> and <code>async</code> to make sure we wait for the future to complete and only then call task3 with the data returned from task2.</p>
<iframe style="width:600px;height:800px;" src="https://dartpad.dev/embed-inline.html?id=56cedd47c4123e825ddce3313acecfe4"></iframe>

<p><strong>Useful Links</strong></p>
<ol>
<li><a href="https://dart.dev/codelabs/async-await">CodeLab</a></li>
<li><a href="https://dart.dev/language/async">Asynchrony support</a></li>
<li><a href="https://dart.dev/language/concurrency">Concurrency in Dart</a></li>
<li><a href="https://www.youtube.com/playlist?list=PL5cilqU9W7KR9TxPt2vEBAss1bLr2GThB">Official YouTube Series on Async in Dart</a></li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../1.3_oop/" class="btn btn-neutral float-left" title="1.3 OOP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../1.5_null_safety/" class="btn btn-neutral float-right" title="1.5 Null Safety">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../1.3_oop/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../1.5_null_safety/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
